<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HTML Fetch Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Prism.js (HTML syntax highlighting) -->
<link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">

<style>
body {
  font-family: system-ui, sans-serif;
  background: linear-gradient(135deg, #667eea, #764ba2);
  padding: 30px;
}

.container {
  max-width: 900px;
  margin: auto;
  background: #fff;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.2);
}

h2 {
  margin-bottom: 15px;
}

input {
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 15px;
}

.selector-row {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.selector-row input {
  flex: 1;
}

.add-btn {
  padding: 12px 16px;
  background: #667eea;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 18px;
}

.fetch-btn {
  margin-top: 15px;
  width: 100%;
  padding: 14px;
  background: #764ba2;
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
}

.results {
  margin-top: 30px;
}

.result-block {
  background: #1e1e1e;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 25px;
}

.result-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.result-header span {
  font-weight: bold;
  color: #9cdcfe;
}

.copy-btn {
  background: #0d6efd;
  color: #fff;
  border: none;
  padding: 6px 14px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 13px;
}

.copy-btn.copied {
  background: #28a745;
}

pre {
  margin: 0;
  border-radius: 8px;
  font-size: 13px;
  max-height: 500px;
  overflow: auto;
}
</style>
</head>

<body>

<div class="container">
  <h2>Fetch HTML by Class or ID</h2>

  <input id="url" placeholder="Enter webpage URL (https://example.com)">

  <div id="selectors">
    <div class="selector-row">
      <input placeholder=".class or #id">
      <button class="add-btn" onclick="addSelector()">+</button>
    </div>
  </div>

  <button class="fetch-btn" onclick="fetchContent()">Fetch HTML</button>

  <div class="results" id="results"></div>
</div>

<!-- Prism.js -->
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-markup.min.js"></script>

<script>
function addSelector() {
  const row = document.createElement('div');
  row.className = 'selector-row';
  row.innerHTML = `
    <input placeholder=".class or #id">
    <button class="add-btn" onclick="this.parentElement.remove()">âˆ’</button>
  `;
  document.getElementById('selectors').appendChild(row);
}

async function fetchContent() {
  const url = document.getElementById('url').value.trim();
  const selectors = [...document.querySelectorAll('#selectors input')]
    .map(i => i.value.trim())
    .filter(Boolean);

  if (!url || selectors.length === 0) {
    alert('Please enter URL and at least one selector');
    return;
  }

  const res = await fetch('/api/fetch', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ url, selectors })
  });

  const data = await res.json();
  renderResults(data);
}

function escapeHTML(str) {
  if (!str) return '';
  return str
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;');
}

function renderResults(data) {
  const results = document.getElementById('results');
  results.innerHTML = '';

  data.forEach(item => {
    const block = document.createElement('div');
    block.className = 'result-block';

    const escaped = escapeHTML(item.content || 'Not Found');

    block.innerHTML = `
      <div class="result-header">
        <span>${item.selector}</span>
        <button class="copy-btn" onclick="copyCode(this)">Copy</button>
      </div>
      <pre><code class="language-html">${escaped}</code></pre>
    `;

    results.appendChild(block);
  });

  Prism.highlightAll(); // ðŸ”¥ Syntax highlight
}

function copyCode(btn) {
  const code = btn.closest('.result-block').querySelector('code').innerText;
  navigator.clipboard.writeText(code);

  btn.textContent = 'Copied';
  btn.classList.add('copied');

  setTimeout(() => {
    btn.textContent = 'Copy';
    btn.classList.remove('copied');
  }, 1500);
}
</script>

</body>
</html>
